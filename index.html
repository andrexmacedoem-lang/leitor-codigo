<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Avarias</title>

<style>
    body {
        font-family: Arial, sans-serif;
        margin: 20px;
    }
    label {
        font-weight: bold;
    }
    #preview {
        width: 100%;
        max-height: 300px;
        margin-top: 10px;
        display: none;
        border: 2px solid #000;
        border-radius: 8px;
    }
    button {
        margin-top: 8px;
        padding: 10px 15px;
        font-size: 16px;
    }
</style>
</head>
<body>

<h2>游닍 Controle de Avarias</h2>

<form>

    <label>C칩digo do Produto</label><br>
    <input type="text" id="codigo" placeholder="Escaneie o c칩digo" style="width:100%; padding:8px; font-size:16px;" />
    <button type="button" onclick="scan()">游닝 Ler C칩digo de Barras</button>

    <video id="preview"></video>

    <br><br>

    <label>Responsabilidade</label><br>
    <select id="responsavel" style="width:100%; padding:8px; font-size:16px;">
        <option value="">Selecione...</option>
        <option value="whirlpool">Whirlpool</option>
        <option value="venkon">Venkon</option>
    </select>

    <br><br>

    <label>Tipo de Avaria</label><br>
    <select id="tipo" style="width:100%; padding:8px; font-size:16px;">
        <option value="">Selecione...</option>
        <option value="embalagem">Embalagem</option>
        <option value="produto">Produto</option>
    </select>

</form>

<!-- ZXING LIBRARY -->
<script src="https://unpkg.com/@zxing/library@latest"></script>

<script>
async function scan() {
    const preview = document.getElementById("preview");
    preview.style.display = "block";

    // Lista todas as c칙meras do dispositivo
    const devices = await ZXing.BrowserCodeReader.listVideoInputDevices();
    if (devices.length === 0) {
        alert("Nenhuma c칙mera encontrada");
        return;
    }

    // Configura formatos compat칤veis (incluindo o da Whirlpool)
    const hints = new Map();
    hints.set(ZXing.DecodeHintType.POSSIBLE_FORMATS, [
        ZXing.BarcodeFormat.CODE_39,
        ZXing.BarcodeFormat.CODE_93,
        ZXing.BarcodeFormat.CODE_128,
        ZXing.BarcodeFormat.QR_CODE
    ]);

    hints.set(ZXing.DecodeHintType.TRY_HARDER, true);

    const reader = new ZXing.BrowserMultiFormatReader(hints);

    // For칞a c칙mera traseira (a frontal n칚o consegue focar)
    const backCamera = devices.find(d => d.label.toLowerCase().includes("back")) || devices[0];

    reader.decodeFromVideoDevice(backCamera.deviceId, "preview", (result, err) => {
        if (result) {
            document.getElementById("codigo").value = result.text;
            reader.reset();
            preview.style.display = "none";
        }
    });
}
</script>

</body>
</html>


