<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Avarias</title>

<script type="module">
import { BrowserMultiFormatReader } from "https://cdn.jsdelivr.net/npm/@zxing/library@latest/esm/index.js";

let codeReader = new BrowserMultiFormatReader();

window.abrirScanner = function () {
    const preview = document.getElementById("video");
    document.getElementById("scanner").style.display = "block";

    codeReader
        .listVideoInputDevices()
        .then((videoDevices) => {
            const deviceId = videoDevices.length > 1 
                ? videoDevices[1].deviceId 
                : videoDevices[0].deviceId;

            codeReader.decodeFromVideoDevice(deviceId, preview, (result, err) => {
                if (result) {
                    document.getElementById("codigo").value = result.text;

                    codeReader.reset();
                    document.getElementById("scanner").style.display = "none";
                }
            });
        })
        .catch((err) => alert("Erro ao acessar c芒mera: " + err));
};

window.salvar = function () {
    const c = document.getElementById("codigo").value;
    const r = document.getElementById("responsavel").value;
    const t = document.getElementById("tipo").value;

    if (!c || !r || !t) return alert("Preencha tudo.");

    let bloco = document.createElement("div");
    bloco.innerHTML = `
        <p><strong>C贸digo:</strong> ${c}<br>
        <strong>Respons谩vel:</strong> ${r}<br>
        <strong>Tipo:</strong> ${t}</p>
        <hr>
    `;
    document.getElementById("registros").appendChild(bloco);

    document.getElementById("codigo").value = "";
    document.getElementById("responsavel").value = "";
    document.getElementById("tipo").value = "";
};
</script>

<style>
body { font-family: Arial; margin: 20px; }
input, select, button { width: 100%; padding: 12px; font-size: 18px; margin-top: 10px; }
#scanner { display: none; margin-top: 15px; }
video { width: 100%; border: 2px solid #555; border-radius: 8px; }
</style>

</head>
<body>

<h2> Controle de Avarias</h2>

<label>C贸digo do Produto</label>
<input id="codigo" placeholder="Escaneie o c贸digo">

<button onclick="abrirScanner()"> Ler C贸digo de Barras</button>

<div id="scanner">
    <video id="video"></video>
</div>

<label>Responsabilidade</label>
<select id="responsavel">
    <option value="">Selecione...</option>
    <option value="Whirlpool">Whirlpool</option>
    <option value="Venkon">Venkon</option>
</select>

<label>Tipo da Avaria</label>
<select id="tipo">
    <option value="">Selecione...</option>
    <option value="Embalagem">Embalagem</option>
    <option value="Produto">Produto</option>
</select>

<button onclick="salvar()"> Salvar</button>

<h3>Registros</h3>
<div id="registros"></div>

</body>
</html>


