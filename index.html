<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Avarias</title>

<style>
body { font-family: Arial; margin: 20px; }
input, select, button { width: 100%; padding: 12px; font-size: 18px; margin-top: 12px; }
#cameraBox { display: none; margin-top: 20px; }
video { width: 100%; border: 2px solid #333; border-radius: 10px; }
</style>

<script type="module">
import {
    BrowserMultiFormatReader
} from "https://cdn.jsdelivr.net/npm/@zxing/library@latest/esm/index.js";

let reader = new BrowserMultiFormatReader();
let stream = null;

async function iniciarCamera() {
    const cameraBox = document.getElementById("cameraBox");
    const video = document.getElementById("video");

    cameraBox.style.display = "block"; // v√≠deo deve aparecer antes do request

    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: {
                facingMode: { ideal: "environment" }
            }
        });

        video.srcObject = stream;
        video.setAttribute("playsinline", true); // obrigat√≥rio no iPhone
        video.play();

        reader.decodeFromVideoDevice(null, video, (result, err) => {
            if (result) {
                document.getElementById("codigo").value = result.text;
                pararCamera();
            }
        });

    } catch (erro) {
        alert("Erro ao acessar c√¢mera: " + erro);
    }
}

function pararCamera() {
    const cameraBox = document.getElementById("cameraBox");
    cameraBox.style.display = "none";

    if (stream) {
        stream.getTracks().forEach(t => t.stop());
    }

    reader.reset();
}

window.iniciarCamera = iniciarCamera;
window.pararCamera = pararCamera;

window.salvar = function() {
    let c = document.getElementById("codigo").value;
    let r = document.getElementById("responsavel").value;
    let t = document.getElementById("tipo").value;

    if (!c || !r || !t) {
        alert("Preencha tudo");
        return;
    }

    let div = document.createElement("div");
    div.innerHTML = `
        <p><strong>C√≥digo:</strong> ${c}<br>
        <strong>Respons√°vel:</strong> ${r}<br>
        <strong>Tipo:</strong> ${t}</p>
        <hr>
    `;

    document.getElementById("registros").appendChild(div);

    document.getElementById("codigo").value = "";
    document.getElementById("responsavel").value = "";
    document.getElementById("tipo").value = "";
};
</script>
</head>
<body>

<h2>üì¶ Controle de Avarias</h2>

<label>C√≥digo do Produto</label>
<input id="codigo" placeholder="Escaneie o c√≥digo">

<button onclick="iniciarCamera()">üì∑ Ler C√≥digo de Barras</button>

<div id="cameraBox">
    <video id="video"></video>
    <button style="margin-top:10px;background:#d33;color:white" onclick="pararCamera()">‚ùå Fechar C√¢mera</button>
</div>

<label>Responsabilidade</label>
<select id="responsavel">
    <option value="">Selecione...</option>
    <option value="Whirlpool">Whirlpool</option>
    <option value="Venkon">Venkon</option>
</select>

<label>Tipo da Avaria</label>
<select id="tipo">
    <option value="">Selecione...</option>
    <option value="Embalagem">Embalagem</option>
    <option value="Produto">Produto</option>
</select>

<button onclick="salvar()">üíæ Salvar</button>

<h3>Registros</h3>
<div id="registros"></div>

</body>
</html>



