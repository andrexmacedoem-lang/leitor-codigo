<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Avarias</title>

<script type="module">
import { BrowserMultiFormatReader } from "https://cdn.jsdelivr.net/npm/@zxing/library@latest/esm/index.js";

let codeReader = new BrowserMultiFormatReader();

window.abrirScanner = async function () {
    const scannerBox = document.getElementById("scanner");
    const video = document.getElementById("video");

    // Torna o v칤deo vis칤vel antes de pedir permiss칚o
    scannerBox.style.display = "block";

    try {
        const devices = await codeReader.listVideoInputDevices();

        if (devices.length === 0) {
            alert("Nenhuma c칙mera detectada.");
            return;
        }

        const deviceId = devices[0].deviceId;

        codeReader.decodeFromVideoDevice(deviceId, video, (result, err) => {
            if (result) {
                document.getElementById("codigo").value = result.text;
                codeReader.reset();
                scannerBox.style.display = "none";
            }
        });

    } catch (err) {
        alert("Erro ao acessar c칙mera: " + err);
    }
};

window.salvar = function () {
    const c = document.getElementById("codigo").value;
    const r = document.getElementById("responsavel").value;
    const t = document.getElementById("tipo").value;

    if (!c || !r || !t) return alert("Preencha tudo.");

    let bloco = document.createElement("div");
    bloco.innerHTML = `
        <p><strong>C칩digo:</strong> ${c}<br>
        <strong>Respons치vel:</strong> ${r}<br>
        <strong>Tipo:</strong> ${t}</p>
        <hr>
    `;
    document.getElementById("registros").appendChild(bloco);

    document.getElementById("codigo").value = "";
    document.getElementById("responsavel").value = "";
    document.getElementById("tipo").value = "";
};
</script>

<style>
body { font-family: Arial; margin: 20px; }
input, select, button { width: 100%; padding: 12px; font-size: 18px; margin-top: 10px; }
#scanner { display: none; margin-top: 15px; }
video { width: 100%; border: 2px solid #555; border-radius: 8px; }
</style>

</head>
<body>

<h2>游닍 Controle de Avarias</h2>

<label>C칩digo do Produto</label>
<input id="codigo" placeholder="Escaneie o c칩digo">

<button onclick="abrirScanner()">游닝 Ler C칩digo de Barras</button>

<div id="scanner">
    <video id="video" playsinline></video>
</div>

<label>Responsabilidade</label>
<select id="responsavel">
    <option value="">Selecione...</option>
    <option value="Whirlpool">Whirlpool</option>
    <option value="Venkon">Venkon</option>
</select>

<label>Tipo da Avaria</label>
<select id="tipo">
    <option value="">Selecione...</option>
    <option value="Embalagem">Embalagem</option>
    <option value="Produto">Produto</option>
</select>

<button onclick="salvar()">游 Salvar</button>

<h3>Registros</h3>
<div id="registros"></div>

</body>
</html>


