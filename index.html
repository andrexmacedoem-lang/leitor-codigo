<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Controle de Avarias</title>

<style>
    body { font-family: Arial; margin: 20px; }
    label { font-weight: bold; }
    video { width: 100%; border: 2px solid #000; border-radius: 8px; display: none; }
    button { margin-top: 10px; padding: 12px; font-size: 18px; width: 100%; }
</style>
</head>
<body>

<h2>ðŸ“¦ Controle de Avarias</h2>

<label>CÃ³digo do Produto</label>
<input type="text" id="codigo" style="width:100%; padding:8px; font-size:18px;" placeholder="Escaneie o cÃ³digo">

<button onclick="startScanner()">ðŸ“· Ler CÃ³digo de Barras</button>

<video id="camera" playsinline></video>

<br><br>

<label>Responsabilidade</label>
<select id="responsavel" style="width:100%; padding:8px; font-size:16px;">
    <option value="">Selecione...</option>
    <option value="whirlpool">Whirlpool</option>
    <option value="venkon">Venkon</option>
</select>

<br><br>

<label>Tipo de Avaria</label>
<select id="tipo" style="width:100%; padding:8px; font-size:16px;">
    <option value="">Selecione...</option>
    <option value="embalagem">Embalagem</option>
    <option value="produto">Produto</option>
</select>

<script>
let stream;

async function startScanner() {
    const video = document.getElementById("camera");
    
    // Solicita cÃ¢mera traseira
    stream = await navigator.mediaDevices.getUserMedia({
        video: { facingMode: "environment" }
    });

    video.srcObject = stream;
    video.style.display = "block";
    await video.play();

    scanFrame();
}

async function scanFrame() {
    const video = document.getElementById("camera");

    if (!('BarcodeDetector' in window)) {
        alert("Seu celular nÃ£o Ã© compatÃ­vel com leitura nativa. Vamos colocar outro mÃ©todo.");
        return;
    }

    const detector = new BarcodeDetector({
        formats: ["code_39", "code_128", "code_93"]
    });

    try {
        const barcodes = await detector.detect(video);
        if (barcodes.length > 0) {
            document.getElementById("codigo").value = barcodes[0].rawValue;

            // Para a cÃ¢mera
            stream.getTracks().forEach(track => track.stop());
            video.style.display = "none";
            return;
        }
    } catch (e) {
        console.log("Erro detector:", e);
    }

    requestAnimationFrame(scanFrame);
}
</script>

</body>
</html>


